<!doctype html> <!-- Declaración del tipo de documento, indica que usamos HTML5 -->
<html lang="es" data-bs-theme="dark"> <!-- Raíz del documento: idioma español + tema oscuro Bootstrap por defecto -->
<head>
  <meta charset="utf-8"/> <!-- Codificación UTF-8 para soportar acentos y emojis -->
  <meta name="viewport" content="width=device-width,initial-scale=1"/> <!-- Diseño responsivo para móviles -->
  <title>😺 MeowBlast</title> <!-- Título que se muestra en la pestaña del navegador -->

  <!-- Bootstrap 5 CSS desde CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Fuente retro estilo 8-bits (Press Start 2P) -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <!-- Hoja de estilos personalizada -->
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <!-- Navbar superior fija con botones y título -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary shadow-sm sticky-top">
    <div class="container d-flex justify-content-between align-items-center">
      <!-- Título del juego en el centro -->
      <span class="navbar-brand mx-auto game-title">😺 MeowBlast</span>

      <!-- Controles de la barra lateral derecha -->
      <div class="d-flex align-items-center gap-2 ms-auto">
        <!-- Control de volumen (solo visible en pantallas medianas o grandes) -->
        <div class="d-none d-sm-flex align-items-center gap-1">
          <button class="btn btn-outline-secondary btn-sm" id="btnMute" title="Silenciar/activar">🔊</button>
          <input type="range" id="volRange" min="0" max="100" value="80" class="form-range vol-range">
        </div>
        <!-- Botones para cambiar tema -->
        <button class="btn btn-outline-secondary btn-sm" id="btnThemeDark" title="Tema oscuro">🌙</button>
        <button class="btn btn-outline-secondary btn-sm" id="btnThemeLight" title="Tema claro">☀️</button>
        <!-- Botones de menú -->
        <button class="btn btn-outline-secondary btn-sm" id="btnControls">Controles</button>
        <button class="btn btn-outline-secondary btn-sm" id="btnAchievements">Logros</button>
        <!-- Botones de control del juego -->
        <button class="btn btn-outline-info btn-sm" id="btnPause">Pausa (P)</button>
        <button class="btn btn-outline-warning btn-sm" id="btnRestart">Reiniciar</button>
      </div>
    </div>
  </nav>

  <!-- Contenido principal -->
  <main class="container my-3">
    <div class="row g-3">
      <!-- Escenario principal del juego -->
      <div class="col-12 col-xl-8">
        <div class="card card-stage shadow-lg">
          <div class="card-header py-2">
            <!-- HUD con información de partida -->
            <div class="d-flex align-items-center justify-content-between">
              <!-- Vidas, nivel, ratones, rango, velocidad, tiempo y monedas -->
              <div class="d-flex gap-3 small text-secondary">
                <div>Vidas: <span class="badge text-bg-light" id="lives">3</span></div>
                <div>Nivel: <span class="badge text-bg-light"><span id="level">1</span>/5</span></div>
                <div>Ratones: <span class="badge text-bg-light"><span id="mice">0</span>/<span id="miceMax">1</span></span></div>
                <div>Rango: <span class="badge text-bg-light" id="range">2</span></div>
                <div>Vel: <span class="badge text-bg-light" id="speed">1.0</span></div>
                <div>Tiempo: <span class="badge text-bg-light" id="time">180</span>s</div>
                <div>🐟: <span class="badge text-bg-info text-dark" id="coins">0</span></div>
              </div>
              <!-- Recordatorio de teclas (visible en pantallas medianas+) -->
              <div class="small text-secondary d-none d-md-block">
                WASD/Flechas · <kbd>Z</kbd> Ratón · <kbd>P</kbd> Pausa · <kbd>X</kbd> Confirmar
              </div>
            </div>
          </div>

          <!-- Área de juego -->
          <div class="card-body d-flex justify-content-center">
            <div class="canvas-stack stage-3d" id="stage">
              <canvas id="game" width="624" height="528" aria-label="MeowBlast"></canvas>

              <!-- Banner de nivel -->
              <div id="banner" class="banner hidden">
                <div id="bannerText">Nivel</div>
              </div>

              <!-- Etiquetas en esquinas del escenario -->
              <div class="corner tl"><span class="chip chip-cat">Gato</span></div>
              <div class="corner tr"><span class="chip chip-mouse">Ratón</span></div>
              <div class="corner bl"><span class="chip chip-dog">Perro</span></div>
              <div class="corner br"><span class="chip chip-door">Puerta</span></div>

              <!-- Controles táctiles para móviles -->
              <div class="touch-controls d-md-none" id="touchControls" aria-hidden="true">
                <div class="dpad" id="dpad">
                  <button data-dir="up"    aria-label="Arriba">▲</button>
                  <div class="mid">
                    <button data-dir="left"  aria-label="Izquierda">◀</button>
                    <button data-dir="right" aria-label="Derecha">▶</button>
                  </div>
                  <button data-dir="down"  aria-label="Abajo">▼</button>
                </div>
                <button class="btn-bomb" id="btnBomb" aria-label="Poner bomba">💣</button>
                <button class="btn-pause" id="btnTPause" aria-label="Pausa">⏸</button>
              </div>
            </div>
          </div>

          <!-- Instrucción de objetivo -->
          <div class="card-footer py-2 small text-secondary">
            Objetivo: come 🐟, elimina 🐶, descubre la <b>puerta</b> bajo una caja y entra cuando no queden enemigos.
          </div>
        </div>
      </div>

      <!-- Panel lateral con consejos y minimapa -->
      <div class="col-12 col-xl-4">
        <!-- Consejos del juego -->
        <div class="card shadow-sm mb-3">
          <div class="card-header">Consejos</div>
          <div class="card-body small">
            <ul class="mb-0">
              <li>🐭 Los <b>ratones (bombas)</b> bloquean el paso y explotan tras unos segundos.</li>
              <li>💥 La explosión es en <b>cruz</b> y puede activar otras bombas en cadena.</li>
              <li>🐶➡️😺 El contacto <b>Perro↔Gato</b> o <b>Fuego↔Gato</b> siempre resta una vida.</li>
              <li>🐟 Las <b>sardinas</b> otorgan mejoras: más <u>rango</u>, más <u>bombas</u> y mayor <u>velocidad</u>.</li>
              <li>🚪 La <b>puerta</b> aparece bajo una caja y se abre solo cuando no queden perros.</li>
              <li>⏱️ ¡El tiempo corre! Termina antes de que llegue a cero.</li>
            </ul>
          </div>
        </div>

        <!-- Minimap + opción reducir animaciones -->
        <div class="card shadow-sm">
          <div class="card-header">Minimapa</div>
          <div class="card-body">
            <canvas id="minimap" width="240" height="180" class="w-100 border rounded" aria-label="Minimapa"></canvas>
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" id="chkReduceMotion">
              <label class="form-check-label" for="chkReduceMotion">Reducir animaciones</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Modales del juego (pausa, nivel superado, resumen final, tienda, controles, logros) -->
  <!-- Modal Pausa -->
  <div class="modal fade" id="modalPause" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content shadow">
      <div class="modal-header"><h5 class="modal-title">Pausa</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">Presiona <kbd>P</kbd> para reanudar o <kbd>X</kbd> para cerrar.</div>
      <div class="modal-footer"><button class="btn btn-primary" data-modal-action="resume">Reanudar (P)</button></div>
    </div></div>
  </div>

  <!-- Modal Nivel superado -->
  <div class="modal fade" id="modalLevelClear" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content shadow">
      <div class="modal-header"><h5 class="modal-title">¡Nivel superado! 🎉</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="levelStats"></div>
      <div class="modal-footer">
        <button class="btn btn-warning" data-modal-action="shop">Tienda 🐟</button>
        <button class="btn btn-success" data-modal-action="next">Siguiente (X)</button>
        <button class="btn btn-outline-light" data-modal-action="finish">Terminar aquí</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Resumen final -->
  <div class="modal fade" id="modalFinish" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content shadow">
      <div class="modal-header"><h5 class="modal-title" id="finishTitle">Resumen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body"><div id="finalStats"></div></div>
      <div class="modal-footer"><button class="btn btn-primary" data-modal-action="restart">Reiniciar (X)</button></div>
    </div></div>
  </div>

  <!-- Modal Tienda -->
  <div class="modal fade" id="modalShop" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Tienda de Sardinas 🐟</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <!-- Saldo y mejoras disponibles -->
        <p class="small text-secondary mb-2">Saldo: <b id="shopCoins">0</b> 🐟</p>
        <div class="row g-2">
          <!-- Botones de mejoras -->
          <div class="col-12">
            <button class="btn w-100 btn-outline-info d-flex justify-content-between align-items-center" data-shop="range">
              +1 Rango <span class="badge text-bg-dark">Costo: 3 🐟</span>
            </button>
          </div>
          <div class="col-12">
            <button class="btn w-100 btn-outline-info d-flex justify-content-between align-items-center" data-shop="max">
              +1 Bomba <span class="badge text-bg-dark">Costo: 3 🐟</span>
            </button>
          </div>
          <div class="col-12">
            <button class="btn w-100 btn-outline-info d-flex justify-content-between align-items-center" data-shop="speed">
              +0.2 Velocidad <span class="badge text-bg-dark">Costo: 2 🐟</span>
            </button>
          </div>
          <div class="col-12">
            <button class="btn w-100 btn-outline-success d-flex justify-content-between align-items-center" data-shop="life">
              +1 Vida <span class="badge text-bg-dark">Costo: 5 🐟</span>
            </button>
          </div>
        </div>
        <p class="mt-2 small text-secondary mb-0">Las mejoras se aplican de inmediato y persisten durante la partida.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button class="btn btn-success" data-modal-action="next-from-shop">Siguiente nivel</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Controles personalizados -->
  <div class="modal fade" id="modalControls" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered"><div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Controles personalizados</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div id="controlsList" class="list-group small"></div>
        <div class="d-flex gap-2 mt-3">
          <button id="btnRestoreKeys" class="btn btn-outline-danger btn-sm">Restaurar por defecto</button>
          <span class="text-secondary small">Haz clic en un control y presiona una tecla.</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div></div>
  </div>

  <!-- Modal Logros -->
  <div class="modal fade" id="modalAchievements" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Logros</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div id="achList" class="row g-2"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div></div>
  </div>

  <!-- Scripts Bootstrap y lógica del juego -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="game.js"></script>
</body>
</html>
